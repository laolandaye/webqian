var appData = {"app":{"appLabel":"金服数据开放","appKey":"8aa68abb6e305587016e34fe2db60032"},"appReqTimesInfoDay":[{"apiErrTimes":51,"timeId":"2019-12-26 00:00:00","apiReqTimes":722,"apiSuccessTimes":671,"timeIdHour":"00:00"},{"apiErrTimes":28,"timeId":"2019-12-26 01:00:00","apiReqTimes":1037,"apiSuccessTimes":1009,"timeIdHour":"01:00"},{"apiErrTimes":28,"timeId":"2019-12-26 02:00:00","apiReqTimes":512,"apiSuccessTimes":484,"timeIdHour":"02:00"},{"apiErrTimes":28,"timeId":"2019-12-26 03:00:00","apiReqTimes":710,"apiSuccessTimes":682,"timeIdHour":"03:00"},{"apiErrTimes":33,"timeId":"2019-12-26 04:00:00","apiReqTimes":957,"apiSuccessTimes":924,"timeIdHour":"04:00"},{"apiErrTimes":43,"timeId":"2019-12-26 05:00:00","apiReqTimes":733,"apiSuccessTimes":690,"timeIdHour":"05:00"},{"apiErrTimes":58,"timeId":"2019-12-26 06:00:00","apiReqTimes":590,"apiSuccessTimes":532,"timeIdHour":"06:00"},{"apiErrTimes":6,"timeId":"2019-12-26 07:00:00","apiReqTimes":531,"apiSuccessTimes":525,"timeIdHour":"07:00"},{"apiErrTimes":34,"timeId":"2019-12-26 08:00:00","apiReqTimes":1226,"apiSuccessTimes":1192,"timeIdHour":"08:00"},{"apiErrTimes":40,"timeId":"2019-12-26 09:00:00","apiReqTimes":1240,"apiSuccessTimes":1200,"timeIdHour":"09:00"},{"apiErrTimes":29,"timeId":"2019-12-26 10:00:00","apiReqTimes":882,"apiSuccessTimes":853,"timeIdHour":"10:00"},{"apiErrTimes":20,"timeId":"2019-12-26 11:00:00","apiReqTimes":823,"apiSuccessTimes":803,"timeIdHour":"11:00"},{"apiErrTimes":24,"timeId":"2019-12-26 12:00:00","apiReqTimes":665,"apiSuccessTimes":641,"timeIdHour":"12:00"},{"apiErrTimes":40,"timeId":"2019-12-26 13:00:00","apiReqTimes":858,"apiSuccessTimes":818,"timeIdHour":"13:00"},{"apiErrTimes":30,"timeId":"2019-12-26 14:00:00","apiReqTimes":601,"apiSuccessTimes":571,"timeIdHour":"14:00"},{"apiErrTimes":25,"timeId":"2019-12-26 15:00:00","apiReqTimes":528,"apiSuccessTimes":503,"timeIdHour":"15:00"},{"apiErrTimes":40,"timeId":"2019-12-26 16:00:00","apiReqTimes":972,"apiSuccessTimes":932,"timeIdHour":"16:00"},{"apiErrTimes":29,"timeId":"2019-12-26 17:00:00","apiReqTimes":1127,"apiSuccessTimes":1098,"timeIdHour":"17:00"},{"apiErrTimes":44,"timeId":"2019-12-26 18:00:00","apiReqTimes":995,"apiSuccessTimes":951,"timeIdHour":"18:00"},{"apiErrTimes":18,"timeId":"2019-12-26 19:00:00","apiReqTimes":988,"apiSuccessTimes":970,"timeIdHour":"19:00"},{"apiErrTimes":15,"timeId":"2019-12-26 20:00:00","apiReqTimes":857,"apiSuccessTimes":842,"timeIdHour":"20:00"},{"apiErrTimes":26,"timeId":"2019-12-26 21:00:00","apiReqTimes":780,"apiSuccessTimes":754,"timeIdHour":"21:00"},{"apiErrTimes":16,"timeId":"2019-12-26 22:00:00","apiReqTimes":721,"apiSuccessTimes":705,"timeIdHour":"22:00"},{"apiErrTimes":30,"timeId":"2019-12-26 23:00:00","apiReqTimes":1050,"apiSuccessTimes":1020,"timeIdHour":"23:00"}],"appReqTimesInfoWeek":[{"apiWeek":"周一","timeIdDate":"2019-12-23","appErrTimes":706,"appSuccessTimes":17610,"appReqTimes":18316},{"apiWeek":"周二","timeIdDate":"2019-12-24","appErrTimes":777,"appSuccessTimes":19406,"appReqTimes":20183},{"apiWeek":"周三","timeIdDate":"2019-12-25","appErrTimes":846,"appSuccessTimes":17960,"appReqTimes":18806},{"apiWeek":"周四","timeIdDate":"2019-12-26","appErrTimes":735,"appSuccessTimes":19370,"appReqTimes":20105},{"apiWeek":"周五","timeIdDate":"2019-12-27","appErrTimes":690,"appSuccessTimes":17260,"appReqTimes":17950},{"apiWeek":"周六","timeIdDate":"2019-12-28","appErrTimes":764,"appSuccessTimes":19103,"appReqTimes":19867},{"apiWeek":"周日","timeIdDate":"2019-12-29","appErrTimes":827,"appSuccessTimes":17647,"appReqTimes":18474}],"appReqTimesDay":20105,"appAvgReqTimes":21814,"appReqTimes":152702,"appKeyList":[{"appLabel":"金服数据开放","appKey":"8aa68abb6e305587016e34fe2db60032"},{"appLabel":"test","appKey":"8aa68abb6e5854e4016e5d2dd124000a"},{"appLabel":"测试应用","appKey":"testAppkey"}],"appReqTimesInfoByApi":[{"appErrTimes":2058,"appSuccessTimes":47675,"appReqTimes":49733,"apiId":"8aa68abb6e305587016e350c79e7003e"},{"appErrTimes":2048,"appSuccessTimes":49049,"appReqTimes":51097,"apiId":"8aa68abb6e305587016e3523fce9004d"},{"appErrTimes":1978,"appSuccessTimes":49894,"appReqTimes":51872,"apiId":"8aa68abb6e305587016e35136b250045"}],"apiList":[{"apiId":"297e8a876ea038ce016ea03b9c590000","apiLabel":"testEs"},{"apiId":"297e8a876ea038ce016ea05d420c0003","apiLabel":"testEs2"},{"apiId":"297e8a876ea55754016ea57264af0000","apiLabel":"getPost"},{"apiId":"297e8a876ea55754016ea57315400001","apiLabel":"getPost2"},{"apiId":"297e8a876ea55754016ea57391c50003","apiLabel":"getPost3"},{"apiId":"297e8a876eb4d857016eb53c4eae0000","apiLabel":"testFwDim"},{"apiId":"297e8a876ec53b6d016ec557427f0001","apiLabel":"testSql"},{"apiId":"402880036eceb1db016eeeeb89820048","apiLabel":"test"},{"apiId":"402880036f171cf7016f1c1d4564000b","apiLabel":"案例库"},{"apiId":"402880036f171cf7016f1ce1fc4f000c","apiLabel":"法律援助申请流程"},{"apiId":"8aa68abb6e305587016e350c79e7003e","apiLabel":"风控外部api-司法-法庭公告"},{"apiId":"8aa68abb6e305587016e35136b250045","apiLabel":"风控外部api-检索-企业信息"},{"apiId":"8aa68abb6e305587016e3523fce9004d","apiLabel":"风控外部api-司法-判决文书"},{"apiId":"8aa68abb6e8d9c33016e90c3f0ea0016","apiLabel":"就"}]};


'use strict';//严格模式
let vue = new Vue({
    el: "#app",
    data: function () {
        return {
            appData: {
                app: {
                    appLabel: ""
                },
                appReqTimes: 0,
                appAvgReqTimes: 0,
            },
        }
    },
    computed: {
        appReqTimesInfoWeekOneChartOption: function () {
            let self = this;
            let appReqTimesInfoWeek = [];
            let xAxisData = [];
            let series0Data = [];
            if(this.appData.appReqTimesInfoWeek && this.appData.appReqTimesInfoWeek.length) {
                appReqTimesInfoWeek = this.appData.appReqTimesInfoWeek;
            }
            for (let i = 0; i < appReqTimesInfoWeek.length; i++) {
                let item = appReqTimesInfoWeek[i];
                series0Data.push(item.appReqTimes);
                xAxisData.push(item.apiWeek);
            }
            let option = {
                tooltip: {
                    trigger: 'axis',
                    formatter: "{b}<br/> 调用次数 : {c}次"
                },
                grid: {
                    left: '-20px',
                    right: '4%',
                    bottom: '3%',
                    top: '23%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    axisLine:{
                        show: false,
                    },
                    axisTick:{
                        show: false,
                    },
                    data:xAxisData
                },
                yAxis: {
                    show:false,
                    type: 'value',
                    axisLine: {onZero: false},
                    axisLabel: {
                        formatter: '{value}'
                    },
                    boundaryGap: false,
                },
                series: [
                    {
                        type: 'line',
                        smooth: true,
                        lineStyle: {
                            width: 3,
                            color : '#00BB8B',
                            shadowColor: '#00BB8B',
                            shadowBlur: 20,
                            shadowOffsetY: -15,
                            shadowOffsetX: 0,
                        },
                        itemStyle: {
                            color : '#00BB8B',
                        },
                        data:series0Data
                    }
                ]
            };
            return option;
        },
        appReqTimesInfoWeekTwoChartOption: function () {
            let self = this;
            let appReqTimesInfoWeek = [];
            let datasetSource = [];
            let appSuccessTimes = ['调用成功'];
            let appErrTimes = ['调用失败'];
            let apiWeek = ['日期'];
            if(this.appData.appReqTimesInfoWeek && this.appData.appReqTimesInfoWeek.length) {
                appReqTimesInfoWeek = this.appData.appReqTimesInfoWeek;
            }
            for (let i = 0; i < appReqTimesInfoWeek.length; i++) {
                let item = appReqTimesInfoWeek[i];
                appSuccessTimes.push(item.appSuccessTimes);
                appErrTimes.push(item.appErrTimes);
                apiWeek.push(item.apiWeek);
            }
            datasetSource.push(apiWeek);
            datasetSource.push(appSuccessTimes);
            datasetSource.push(appErrTimes);
            let option = {
                legend: {},
                tooltip: {
                    trigger: 'axis',
                    formatter: function (params, ticket, callback) {
                        return `${params[0].axisValue }<br />
                                ${params[0].seriesName }:${params[0].data[1] }次<br />
                                ${params[1].seriesName }:${params[0].data[2] }次`
                    }
                },
                dataset: {
                    source: datasetSource
                },
                xAxis: [
                    {type: 'category',
                        axisLine:{
                            show: false,
                        },
                        axisTick:{
                            show: false,
                        },
                        gridIndex: 0}
                ],
                yAxis: [
                    {
                        show:false,
                        gridIndex: 0}
                ],
                grid: [
                    {
                        left: '-20px',
                        right: '4%',
                        bottom: '15%',
                        containLabel: true
                    },
                ],
                series: [
                    {   type: 'bar',
                        seriesLayoutBy: 'row',
                        itemStyle:{
                            color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1,
                                [
                                    {offset: 0, color: '#00BB8B'},
                                    {offset: 1, color: '#005E46'}
                                ]
                            ),
                            barBorderRadius:5,
                            borderWidth:0,

                        },
                        barWidth:10
                    },
                    {type: 'bar',
                        seriesLayoutBy: 'row',
                        itemStyle:{
                            color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1,
                                [
                                    {offset: 0, color: '#FF77A1'},
                                    {offset: 1, color: '#A30027'}
                                ]
                            ),
                            barBorderRadius:5,
                            borderWidth:0,
                        },
                        barWidth:10
                    }
                ]
            };
            return option;
        },
        appReqTimesInfoDayChartOption: function () {
            let self = this;
            let appReqTimesInfoDay = [];
            let xAxisData = [];
            let series0Data = [];
            if(this.appData.appReqTimesInfoDay && this.appData.appReqTimesInfoDay.length) {
                appReqTimesInfoDay = this.appData.appReqTimesInfoDay;
            }
            for (let i = 0; i < appReqTimesInfoDay.length; i++) {
                let item = appReqTimesInfoDay[i];
                xAxisData.push(item.timeIdHour);
                series0Data.push(item.apiReqTimes);
            }

            let option = {
                tooltip: {
                    trigger: 'axis',
                    formatter: "{b}<br/> 调用次数 : {c}次",
                    position: function (pt) {
                        return [pt[0], '10%'];
                    }
                },
                title:{
                    text: '日调用变化趋势',
                    textStyle: {
                        fontSize:'18px',
                        fontFamily:'Microsoft YaHei',
                        fontWeight:'400',
                        lineHeight:'60px',
                        color:'rgba(34,34,34,1)',
                    },
                    top: '2%',
                    left: '2%',
                },
                grid: [
                    {
                        left: '4%',
                        right: '8%',
                        bottom: '15%',
                        containLabel: true
                    },
                ],
                xAxis: {
                    name: '/API名称',
                    type: 'category',
                    axisLine:{
                        show: false,
                    },
                    axisLabel: {
                        show: true,
                        fontSize: '12'
                    },
                    axisTick:{
                        show: false,
                    },
                    gridIndex: 0,
                    boundaryGap: false,
                    data: xAxisData
                },
                yAxis: {
                    name: '      /次数',
                    type: 'value',
                    boundaryGap: [0, '100%']
                },
                dataZoom: [{
                    type: 'inside',
                    start: 0,
                    end: 100
                }, {
                    start: 0,
                    end: 100,
                    handleSize: '80%',
                    handleStyle: {
                        color: '#fff',
                        shadowBlur: 3,
                        shadowColor: 'rgba(0, 0, 0, 0.6)',
                        shadowOffsetX: 2,
                        shadowOffsetY: 2
                    }
                }],
                series: [
                    {
                        type: 'line',
                        smooth: true,
                        lineStyle: {
                            width: 3,
                            color : '#00BB8B',
                            shadowColor: '#00BB8B',
                            shadowBlur: 20,
                            shadowOffsetY: -15,
                            shadowOffsetX: 0,
                        },
                        itemStyle: {
                            color : '#00BB8B',
                        },
                        data: series0Data
                    }
                ]
            };
            return option;
        },
        appReqTimesInfoByApiChartOption: function () {
            let self = this;
            let appReqTimesInfoByApi = [];
            let datasetSource = [];
            let appSuccessTimes = ['调用成功'];
            let appErrTimes = ['调用失败'];
            let apiId = ['API名称'];
            if(this.appData.appReqTimesInfoByApi && this.appData.appReqTimesInfoByApi.length) {
                appReqTimesInfoByApi = commonMain.getJpaMany2One(this.appData.appReqTimesInfoByApi, this.appData.apiList, ['apiId', 'apiPo']);
            }
            for (let i = 0; i < appReqTimesInfoByApi.length; i++) {
                let item = appReqTimesInfoByApi[i];
                appSuccessTimes.push(item.appSuccessTimes);
                appErrTimes.push(item.appErrTimes);
                apiId.push(item.apiPo.apiLabel);
            }
            datasetSource.push(apiId);
            datasetSource.push(appSuccessTimes);
            datasetSource.push(appErrTimes);
            let option = {
                title:{
                    text: 'API分类-累计调用次数',
                    textStyle: {
                        fontSize:'18px',
                        fontFamily:'Microsoft YaHei',
                        fontWeight:'400',
                        lineHeight:'60px',
                        color:'rgba(34,34,34,1)',
                    },
                    top: '2%',
                    left: '2%',
                },
                legend: {
                    top: '2%',
                    right: '2%',
                },
                tooltip: {
                    trigger: 'axis',
                    formatter: function (params, ticket, callback) {
                        return `${params[0].axisValue }<br />
                                ${params[0].seriesName }:${params[0].data[1] }次<br />
                                ${params[1].seriesName }:${params[0].data[2] }次`
                    }
                },
                dataset: {
                    source: datasetSource
                },
                xAxis: [
                    {
                        name: '/API名称',
                        type: 'category',
                        axisLine:{
                            show: false,
                        },
                        axisLabel: {
                            show: true,
                            fontSize: '12'
                        },
                        axisTick:{
                            show: false,
                        },
                        gridIndex: 0
                    }
                ],
                yAxis: [
                    {
                        name: '      /次数',
                        type: 'value',
                        axisLine: {onZero: false},
                        axisLabel: {
                            formatter: '{value}'
                        },
                        boundaryGap: false,
                    }
                ],
                grid: [
                    {
                        left: '4%',
                        right: '8%',
                        bottom: '15%',
                        containLabel: true
                    },
                ],
                series: [
                    {
                        type: 'bar',
                        seriesLayoutBy: 'row',
                        itemStyle:{
                            color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1,
                                [
                                    {offset: 0, color: '#00BB8B'},
                                    {offset: 1, color: '#005E46'}
                                ]
                            ),
                            barBorderRadius:5,
                            borderWidth:0,

                        },
                        barWidth:10
                    },
                    {type: 'bar',
                        seriesLayoutBy: 'row',
                        itemStyle:{
                            color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1,
                                [
                                    {offset: 0, color: '#FF77A1'},
                                    {offset: 1, color: '#A30027'}
                                ]
                            ),
                            barBorderRadius:5,
                            borderWidth:0,
                        },
                        barWidth:10
                    }
                ]
            };
            return option;
        },
    },
    methods: {
    	getContextPath: function () {
            let local = document.location;
            let contextPath = "/" + local.pathname.split('/')[1];
            let basePath = local.protocol + "//" + local.host + "/" + contextPath;
            this.contextPath = contextPath;//项目路径
        },
    	initAppReqTimesInfoWeekOneChart: function () {
            let self = this;
            this.appReqTimesInfoWeekOneChart = echarts.init(this.$refs.appReqTimesInfoWeekOne);
            this.appReqTimesInfoWeekOneChart && this.appReqTimesInfoWeekOneChart.setOption(this.appReqTimesInfoWeekOneChartOption);
            window.addEventListener("resize", function () {
                self.appReqTimesInfoWeekOneChart && self.appReqTimesInfoWeekOneChart.resize();
            });
        },
        initAppReqTimesInfoWeekTwoChart: function () {
            let self = this;
            this.appReqTimesInfoWeekTwoChart = echarts.init(this.$refs.appReqTimesInfoWeekTwo);
            this.appReqTimesInfoWeekTwoChart && this.appReqTimesInfoWeekTwoChart.setOption(this.appReqTimesInfoWeekTwoChartOption);
            window.addEventListener("resize", function () {
                self.appReqTimesInfoWeekTwoChart && self.appReqTimesInfoWeekTwoChart.resize();
            });
        },
        initAppReqTimesInfoDayChart: function () {
            let self = this;
            this.appReqTimesInfoDayChart = echarts.init(this.$refs.appReqTimesInfoDay);
            this.appReqTimesInfoDayChart && this.appReqTimesInfoDayChart.setOption(this.appReqTimesInfoDayChartOption);
            window.addEventListener("resize", function () {
                self.appReqTimesInfoDayChart && self.appReqTimesInfoDayChart.resize();
            });
        },
        initAppReqTimesInfoByApiChart: function () {
            let self = this;
            this.appReqTimesInfoByApiChart = echarts.init(this.$refs.appReqTimesInfoByApi);
            this.appReqTimesInfoByApiChart && this.appReqTimesInfoByApiChart.setOption(this.appReqTimesInfoByApiChartOption);
            window.addEventListener("resize", function () {
                self.appReqTimesInfoByApiChart && self.appReqTimesInfoByApiChart.resize();
            });
        },
    },
    watch: {//监听数据变化
        appReqTimesInfoWeekOneChartOption: function (newVal) {
            this.appReqTimesInfoWeekOneChart && this.appReqTimesInfoWeekOneChart.setOption(newVal);
        },
        appReqTimesInfoWeekTwoChartOption: function (newVal) {
            this.appReqTimesInfoWeekTwoChart && this.appReqTimesInfoWeekTwoChart.setOption(newVal);
        },
        appReqTimesInfoDayChartOption: function (newVal) {
            this.appReqTimesInfoDayChart && this.appReqTimesInfoDayChart.setOption(newVal);
        },
        appReqTimesInfoByApiChartOption: function (newVal) {
            this.appReqTimesInfoByApiChart && this.appReqTimesInfoByApiChart.setOption(newVal);
        },
    },
    beforeCreate: function(){
        let self = this;
        this.contextPath = '';
        this.appReqTimesInfoWeekOne = {};
        this.appReqTimesInfoWeekTwo = {};
        this.appReqTimesInfoDay = {};
        this.appReqTimesInfoByApi = {};
    },
    created: function () {
        let self = this;
        this.getContextPath();
        this.appData = appData;
    },
    mounted: function () {
        let self = this;
        this.$nextTick(function () {
            self.initAppReqTimesInfoWeekOneChart();
            self.initAppReqTimesInfoWeekTwoChart();
            self.initAppReqTimesInfoDayChart();
            self.initAppReqTimesInfoByApiChart();
        });
    },
    distroyed: function () {
        let self = this;
    }
});